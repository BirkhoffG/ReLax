---

title: Neural Networks


keywords: fastai
sidebar: home_sidebar

summary: "Define useful nn in `haiku`"
description: "Define useful nn in `haiku`"
nb_path: "nbs/02_nets.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/02_nets.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h2 id="DenseBlock" class="doc_header"><code>class</code> <code>DenseBlock</code><a href="https://github.com/birkhoffg/cfnet/tree/master/cfnet/nets.py#L10" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>DenseBlock</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Module</code></p>
</blockquote>
<p>Base class for Haiku modules.</p>
<p>A Haiku module is a lightweight container for variables and other modules.
Modules typically define one or more "forward" methods (e.g. <code>__call__</code>)
which apply operations combining user input and module parameters.</p>
<p>Modules must be initialized inside a :func:<code>transform</code> call.</p>
<p>For example:</p>
<blockquote><blockquote><blockquote><p>class AddModule(hk.Module):
...   def <strong>call</strong>(self, x):
...     w = hk.get_parameter("w", [], init=jnp.ones)
...     return x + w</p>
<p>def forward_fn(x):
...   mod = AddModule()
...   return mod(x)</p>
<p>forward = hk.transform(forward_fn)
x = 1.
rng = None
params = forward.init(rng, x)
forward.apply(params, None, x)
DeviceArray(2., dtype=float32)</p>
</blockquote>
</blockquote>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h2 id="MLP" class="doc_header"><code>class</code> <code>MLP</code><a href="https://github.com/birkhoffg/cfnet/tree/master/cfnet/nets.py#L31" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MLP</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Module</code></p>
</blockquote>
<p>Base class for Haiku modules.</p>
<p>A Haiku module is a lightweight container for variables and other modules.
Modules typically define one or more "forward" methods (e.g. <code>__call__</code>)
which apply operations combining user input and module parameters.</p>
<p>Modules must be initialized inside a :func:<code>transform</code> call.</p>
<p>For example:</p>
<blockquote><blockquote><blockquote><p>class AddModule(hk.Module):
...   def <strong>call</strong>(self, x):
...     w = hk.get_parameter("w", [], init=jnp.ones)
...     return x + w</p>
<p>def forward_fn(x):
...   mod = AddModule()
...   return mod(x)</p>
<p>forward = hk.transform(forward_fn)
x = 1.
rng = None
params = forward.init(rng, x)
forward.apply(params, None, x)
DeviceArray(2., dtype=float32)</p>
</blockquote>
</blockquote>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h2 id="PredictiveModel" class="doc_header"><code>class</code> <code>PredictiveModel</code><a href="https://github.com/birkhoffg/cfnet/tree/master/cfnet/nets.py#L53" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PredictiveModel</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Module</code></p>
</blockquote>
<p>Base class for Haiku modules.</p>
<p>A Haiku module is a lightweight container for variables and other modules.
Modules typically define one or more "forward" methods (e.g. <code>__call__</code>)
which apply operations combining user input and module parameters.</p>
<p>Modules must be initialized inside a :func:<code>transform</code> call.</p>
<p>For example:</p>
<blockquote><blockquote><blockquote><p>class AddModule(hk.Module):
...   def <strong>call</strong>(self, x):
...     w = hk.get_parameter("w", [], init=jnp.ones)
...     return x + w</p>
<p>def forward_fn(x):
...   mod = AddModule()
...   return mod(x)</p>
<p>forward = hk.transform(forward_fn)
x = 1.
rng = None
params = forward.init(rng, x)
forward.apply(params, None, x)
DeviceArray(2., dtype=float32)</p>
</blockquote>
</blockquote>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>tests</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">model_forward</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">is_training</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">PredictiveModel</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">dropout_rate</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">is_training</span><span class="p">)</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">hk</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">model_forward</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Transformed(init=&lt;function without_state.&lt;locals&gt;.init_fn at 0x7f8b944037a0&gt;, apply=&lt;function without_state.&lt;locals&gt;.apply_fn at 0x7f8b94403830&gt;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h2 id="CounterNetModel" class="doc_header"><code>class</code> <code>CounterNetModel</code><a href="https://github.com/birkhoffg/cfnet/tree/master/cfnet/nets.py#L80" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CounterNetModel</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Module</code></p>
</blockquote>
<p>Base class for Haiku modules.</p>
<p>A Haiku module is a lightweight container for variables and other modules.
Modules typically define one or more "forward" methods (e.g. <code>__call__</code>)
which apply operations combining user input and module parameters.</p>
<p>Modules must be initialized inside a :func:<code>transform</code> call.</p>
<p>For example:</p>
<blockquote><blockquote><blockquote><p>class AddModule(hk.Module):
...   def <strong>call</strong>(self, x):
...     w = hk.get_parameter("w", [], init=jnp.ones)
...     return x + w</p>
<p>def forward_fn(x):
...   mod = AddModule()
...   return mod(x)</p>
<p>forward = hk.transform(forward_fn)
x = 1.
rng = None
params = forward.init(rng, x)
forward.apply(params, None, x)
DeviceArray(2., dtype=float32)</p>
</blockquote>
</blockquote>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">model_forward</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">is_training</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"enc_sizes"</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="s2">"dec_sizes"</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="s2">"exp_sizes"</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="s2">"dropout_rate"</span><span class="p">:</span> <span class="mf">0.3</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">CounterNetModel</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">is_training</span><span class="p">)</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">hk</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">model_forward</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">key</span> <span class="o">=</span> <span class="n">hk</span><span class="o">.</span><span class="n">PRNGSequence</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="n">xs</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">params</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">xs</span><span class="p">,</span> <span class="n">is_training</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">next</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">xs</span><span class="p">,</span> <span class="n">is_training</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">jax</span><span class="o">.</span><span class="n">tree_map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;counter_net_model/Encoder/dense_block/linear&#39;: {&#39;b&#39;: (10,), &#39;w&#39;: (10, 10)},
 &#39;counter_net_model/Encoder/dense_block_1/linear&#39;: {&#39;b&#39;: (10,), &#39;w&#39;: (10, 10)},
 &#39;counter_net_model/Explainer/dense_block/linear&#39;: {&#39;b&#39;: (10,), &#39;w&#39;: (20, 10)},
 &#39;counter_net_model/Explainer/dense_block_1/linear&#39;: {&#39;b&#39;: (10,),
  &#39;w&#39;: (10, 10)},
 &#39;counter_net_model/Predictor/dense_block/linear&#39;: {&#39;b&#39;: (10,), &#39;w&#39;: (10, 10)},
 &#39;counter_net_model/Predictor/dense_block_1/linear&#39;: {&#39;b&#39;: (10,),
  &#39;w&#39;: (10, 10)},
 &#39;counter_net_model/linear&#39;: {&#39;b&#39;: (1,), &#39;w&#39;: (10, 1)},
 &#39;counter_net_model/linear_1&#39;: {&#39;b&#39;: (10,), &#39;w&#39;: (10, 10)}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>


